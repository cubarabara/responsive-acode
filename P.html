<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Accordion Menu</title>
   <style>
      .nested>ul {
         display: none;
      }
      
      .nested.active>ul {
         display: block;
      }
   </style>
</head>

<body>
   <ul id="accordion">
      <li class="nested">
         Item 1
         <ul>
            <li class="nested">
               Subitem 1.1
               <ul>
                  <li>Sub-subitem 1.1.1</li>
                  <li>Sub-subitem 1.1.2</li>
               </ul>
            </li>
            <li class="nested">
               Subitem 1.2
               <ul>
                  <li>Sub-subitem 1.2.1</li>
                  <li>Sub-subitem 1.2.2</li>
               </ul>
            </li>
         </ul>
      </li>
      <li class="nested">
         Item 2
         <ul>
            <li>
               Subitem 2.1
            </li>
            <li class="nested">
               Subitem 2.2
               <ul>
                  <li>Sub-subitem 2.2.1</li>
               </ul>
            </li>
         </ul>
      </li>
   </ul>
   
   <script>
      /*const accordionItems = document.querySelectorAll('.nested');
        accordionItems.forEach(item => {
            item.addEventListener('click', function(event) {
                item.classList.toggle('active');
                event.stopPropagation();
            });
        });*/
        
         const list = document.querySelectorAll('.nested');
         list.forEach(item => {
            item.addEventListener('click', function(event) {
               event.stopPropagation(); 
               if (this.classList.contains('active')) {
                  this.classList.remove('active');
               } else if (this.parentElement.parentElement.classList.contains('active')) {
                  if (this.classList.contains('active')) {
                     this.classList.remove('active')
                  } else {
                     Array.from(this.parentElement.children).forEach(itemMenu => { 
                        itemMenu.classList.remove('active'); 
                     });
                     this.classList.add('active')
                  }
               } else {
                  list.forEach(dropDownE => {
                     dropDownE.classList.remove('active');
                  });
                  this.classList.add('active');
               }
            });
         });
         
         /*function accordion(event) {
            event.stopPropagation(); 
            var that = this;
            if (that.classList.contains('active')){
               that.classList.remove('active');
            } else if(that.parentElement.parentElement.classList.contains('active')){
                that.classList.add('active');
            } else {
               for(i=0; i < list.length; i++){
                  list[i].classList.remove('active');
               }
               that.classList.add('active');
            }
         }
         for(i = 0; i < list.length; i++ ){
            list[i].addEventListener('click', accordion);
         }*/
      
   </script>
</body>

</html>